{% extends "base.html" %}

{% block extra_css %}
<style>
    .mode-selector {
        margin-bottom: 30px;
        text-align: center;
    }

    .mode-btn {
        padding: 15px 30px;
        margin: 0 10px;
        border: 2px solid #3498db;
        background: white;
        color: #3498db;
        cursor: pointer;
        border-radius: 5px;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s;
    }

    .mode-btn.active {
        background: #3498db;
        color: white;
    }

    .mode-btn:hover {
        background: #3498db;
        color: white;
    }

    .form-section {
        background: #f8f9fa;
        padding: 25px;
        margin-bottom: 20px;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }

    .form-section h2 {
        margin-bottom: 20px;
        color: #2c3e50;
        font-size: 1.5rem;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
    }

    .form-group input[type="text"],
    .form-group input[type="file"],
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        font-family: inherit;
    }

    .form-group textarea {
        min-height: 120px;
        resize: vertical;
    }

    .form-group small {
        display: block;
        margin-top: 5px;
        color: #7f8c8d;
        font-size: 0.9rem;
    }

    .batch-container {
        display: none;
    }

    .batch-container.active {
        display: block;
    }

    .speaker-card {
        background: white;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 5px;
        border: 1px solid #e0e0e0;
    }

    .speaker-card h3 {
        margin-bottom: 15px;
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
    }

    .add-speaker-btn {
        background: #27ae60;
        margin-top: 10px;
    }

    .add-speaker-btn:hover {
        background: #229954;
    }

    .submit-section {
        text-align: center;
        padding: 30px 0;
    }

    .required {
        color: #e74c3c;
    }
</style>
{% endblock %}

{% block content %}
<div class="mode-selector">
    <button type="button" class="mode-btn active" data-mode="single">Single Speaker</button>
    <button type="button" class="mode-btn" data-mode="batch">Batch Processing</button>
</div>

<form method="POST" action="{{ url_for('process_speakers') }}" enctype="multipart/form-data" id="speakerForm">
    <input type="hidden" name="processing_mode" id="processing_mode" value="single">
    <input type="hidden" name="speaker_count" id="speaker_count" value="1">

    <!-- Single Speaker Mode -->
    <div id="single-mode" class="single-container">
        <div class="form-section">
            <h2>Speaker Information</h2>

            <div class="form-group">
                <label for="speaker_name">Speaker Name <span class="required">*</span></label>
                <input type="text" id="speaker_name" name="speaker_name" required>
            </div>

            <div class="form-group">
                <label for="bio">Speaker Bio <span class="required">*</span></label>
                <textarea id="bio" name="bio" required></textarea>
                <small>Paste the bio in any format - the AI will process it</small>
            </div>

            <div class="form-group">
                <label for="headshot">Headshot Photo</label>
                <input type="file" id="headshot" name="headshot" accept="image/*">
                <small>Supported formats: JPG, PNG, HEIC, etc.</small>
            </div>
        </div>

        <div class="form-section">
            <h2>Session Information</h2>

            <div class="form-group">
                <label for="session_title">Session Title <span class="required">*</span></label>
                <input type="text" id="session_title" name="session_title" required>
            </div>

            <div class="form-group">
                <label for="session_description">Session Description <span class="required">*</span></label>
                <textarea id="session_description" name="session_description" required></textarea>
                <small>Any format - the AI will create a professional abstract</small>
            </div>

            <div class="form-group">
                <label for="tech_requirements">Tech/AV Requirements</label>
                <textarea id="tech_requirements" name="tech_requirements"></textarea>
                <small>Optional - list any technical needs (mic, projector, etc.)</small>
            </div>
        </div>
    </div>

    <!-- Batch Mode -->
    <div id="batch-mode" class="batch-container">
        <div id="speakers-container">
            <!-- Speaker cards will be added here dynamically -->
        </div>
        <button type="button" class="btn add-speaker-btn" onclick="addSpeaker()">+ Add Another Speaker</button>
    </div>

    <div class="submit-section">
        <button type="submit" class="btn btn-success">ðŸš€ Process Speaker Content</button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
    let speakerCount = 0;

    // Mode switching
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const mode = this.dataset.mode;

            // Update active button
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // Update form mode
            document.getElementById('processing_mode').value = mode;

            // Show/hide appropriate sections
            if (mode === 'single') {
                document.getElementById('single-mode').style.display = 'block';
                document.getElementById('batch-mode').classList.remove('active');
                // Make single mode fields required
                setSingleModeRequired(true);
            } else {
                document.getElementById('single-mode').style.display = 'none';
                document.getElementById('batch-mode').classList.add('active');
                // Make single mode fields not required
                setSingleModeRequired(false);
                // Initialize batch mode if empty
                if (speakerCount === 0) {
                    addSpeaker();
                }
            }
        });
    });

    function setSingleModeRequired(required) {
        document.querySelectorAll('#single-mode [required]').forEach(field => {
            if (required) {
                field.setAttribute('required', 'required');
            } else {
                field.removeAttribute('required');
            }
        });
    }

    function addSpeaker() {
        const container = document.getElementById('speakers-container');
        const card = document.createElement('div');
        card.className = 'speaker-card';
        card.innerHTML = `
            <h3>Speaker ${speakerCount + 1}</h3>

            <div class="form-group">
                <label>Speaker Name <span class="required">*</span></label>
                <input type="text" name="speaker_${speakerCount}_name" required>
            </div>

            <div class="form-group">
                <label>Speaker Bio <span class="required">*</span></label>
                <textarea name="speaker_${speakerCount}_bio" required></textarea>
            </div>

            <div class="form-group">
                <label>Headshot Photo</label>
                <input type="file" name="speaker_${speakerCount}_headshot" accept="image/*">
            </div>

            <div class="form-group">
                <label>Session Title <span class="required">*</span></label>
                <input type="text" name="speaker_${speakerCount}_session_title" required>
            </div>

            <div class="form-group">
                <label>Session Description <span class="required">*</span></label>
                <textarea name="speaker_${speakerCount}_session_description" required></textarea>
            </div>

            <div class="form-group">
                <label>Tech/AV Requirements</label>
                <textarea name="speaker_${speakerCount}_tech_requirements"></textarea>
            </div>
        `;

        container.appendChild(card);
        speakerCount++;
        document.getElementById('speaker_count').value = speakerCount;
    }

    // Form validation
    document.getElementById('speakerForm').addEventListener('submit', function(e) {
        const mode = document.getElementById('processing_mode').value;
        if (mode === 'batch' && speakerCount === 0) {
            e.preventDefault();
            alert('Please add at least one speaker in batch mode');
        }
    });
</script>
{% endblock %}
